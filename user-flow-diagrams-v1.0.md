# 山径APP - 用户流程图设计文档

> **文档版本**: v1.0  
> **制定日期**: 2026-02-27  
> **文档状态**: 设计阶段  
> **适用范围**: Week 2 产品设计阶段

---

## 1. 用户流程图总览

### 1.1 流程图设计原则

基于PRD v1.2中定义的产品定位（城市年轻人的轻度徒步向导），用户流程设计遵循以下原则：

| 原则 | 说明 | 体现 |
|------|------|------|
| **极简路径** | 核心功能3步可达 | 发现→下载→导航 |
| **安全第一** | 安全功能前置提醒 | 导航前检查紧急联系人 |
| **离线优先** | 弱网/无网场景友好 | 离线包下载流程优化 |
| **零门槛** | 新用户无需注册即可浏览 | 游客模式支持 |

---

## 2. 核心用户流程图（Mermaid）

### 2.1 新用户首次使用流程

```mermaid
flowchart TD
    A[用户打开APP] --> B{是否已登录?}
    B -->|是| C[进入首页-发现页]
    B -->|否| D[展示启动页]
    D --> E[进入首页-发现页]
    E --> F{用户行为}
    
    F -->|浏览路线| G[查看路线列表]
    G --> H[查看路线详情]
    H --> I{是否想导航?}
    I -->|是| J[触发登录提示]
    J --> K[微信一键登录]
    K --> L[设置紧急联系人]
    L --> M[下载离线包]
    M --> N[开始导航]
    
    I -->|仅浏览| O[继续浏览/收藏]
    
    F -->|搜索| P[输入搜索关键词]
    P --> Q[查看搜索结果]
    
    F -->|我的| R[触发登录提示]
    R --> K
```

**流程说明**:
1. **游客模式**: 新用户无需登录即可浏览路线、查看详情
2. **登录触发点**: 仅在需要个性化功能（导航、收藏、设置）时触发登录
3. **首次导航强制流程**: 登录→设置紧急联系人→下载离线包→开始导航

---

### 2.2 路线发现流程

```mermaid
flowchart TD
    A[进入发现页] --> B[加载附近路线]
    B --> C{展示方式}
    
    C -->|列表模式| D[路线卡片列表]
    C -->|地图模式| E[地图标记点]
    
    D --> F[下拉刷新]
    D --> G[上拉加载更多]
    
    E --> H[点击标记点]
    E --> I[地图区域筛选]
    
    F --> J{筛选条件}
    G --> J
    I --> J
    
    J -->|距离| K[选择范围: 5/10/20/50km]
    J -->|难度| L[选择: 休闲/轻度/进阶]
    J -->|标签| M[选择标签: 亲子/宠物/摄影/女性友好]
    J -->|时长| N[选择: <2h/2-4h/4-6h/>6h]
    
    K --> O[应用筛选]
    L --> O
    M --> O
    N --> O
    
    O --> P[更新路线列表]
    P --> Q[查看路线详情]
    
    Q --> R{操作选项}
    R -->|收藏| S[添加到收藏夹]
    R -->|分享| T[生成分享卡片]
    R -->|下载| U[下载离线包]
    R -->|导航| V[进入导航准备]
```

**流程说明**:
1. **双模式切换**: 列表模式适合快速浏览，地图模式适合空间感知
2. **多维筛选**: 距离、难度、标签、时长四个维度交叉筛选
3. **筛选记忆**: 用户偏好筛选条件本地缓存，下次自动应用

---

### 2.3 路线导航流程

```mermaid
flowchart TD
    A[点击开始导航] --> B{检查离线包}
    B -->|未下载| C[提示下载离线包]
    C --> D[显示下载进度]
    D --> E[下载完成]
    
    B -->|已下载| F{检查紧急联系人}
    E --> F
    
    F -->|未设置| G[提示设置紧急联系人]
    G --> H[添加1-3位联系人]
    H --> I[保存联系人]
    
    F -->|已设置| J[生成行程分享卡片]
    I --> J
    
    J --> K{是否分享行程?}
    K -->|是| L[分享到微信]
    K -->|否| M[跳过]
    
    L --> N[进入导航页面]
    M --> N
    
    N --> O[加载离线地图]
    O --> P[开始GPS定位]
    P --> Q[匹配轨迹起点]
    
    Q --> R{导航状态}
    
    R -->|正常跟随| S[显示当前位置]
    S --> T[显示进度信息]
    T --> U[语音播报指引]
    
    R -->|偏航检测| V{偏离距离}
    V -->|>30m| W[震动提醒偏航]
    V -->|>50m| X[提示重新规划]
    
    R -->|关键路口| Y[提前50m语音播报]
    Y --> Z[显示路口实景对比]
    
    R -->|安全提醒| AA[每30分钟震动]
    AA --> AB[确认状态正常]
    
    R -->|点击SOS| AC[二次确认弹窗]
    AC --> AD[发送位置给紧急联系人]
    
    R -->|到达终点| AE[导航完成]
    AE --> AF[显示行程总结]
    AF --> AG{是否记录?}
    AG -->|是| AH[保存轨迹记录]
    AG -->|否| AI[返回首页]
```

**流程说明**:
1. **前置检查**: 离线包和紧急联系人是导航开始的必要条件
2. **行程分享**: 导航前生成分享卡片，让亲友知晓行程
3. **多层偏航处理**: 30m提醒，50m重新规划，避免频繁打断
4. **定时安全确认**: 每30分钟震动提醒，用户需确认状态

---

### 2.4 轨迹记录流程

```mermaid
flowchart TD
    A[进入记录页面] --> B[显示准备界面]
    B --> C[GPS信号检测]
    C --> D{信号质量}
    
    D -->|良好| E[显示开始按钮]
    D -->|较弱| F[提示信号弱建议]
    
    E --> G[点击开始记录]
    G --> H[3秒倒计时]
    H --> I[开始记录轨迹]
    
    I --> J{记录状态}
    
    J -->|正常记录| K[后台持续记录GPS]
    K --> L[显示实时数据]
    L --> M[里程/时长/海拔/速度]
    
    J -->|拍照标记| N[打开相机]
    N --> O[拍照并关联GPS]
    O --> P[保存照片标记]
    
    J -->|暂停| Q[点击暂停按钮]
    Q --> R[暂停记录]
    R --> S[显示继续/结束选项]
    
    S -->|继续| T[恢复记录]
    T --> K
    
    S -->|结束| U[点击结束按钮]
    U --> V[二次确认]
    V --> W[停止记录]
    
    W --> X[处理轨迹数据]
    X --> Y[生成轨迹预览]
    Y --> Z{用户操作}
    
    Z -->|保存| AA[保存到本地]
    AA --> AB[进入数据回顾页]
    
    Z -->|发布| AC[进入发布流程]
    
    Z -->|放弃| AD[确认放弃]
    AD --> AE[删除记录]
    AE --> AF[返回首页]
```

**流程说明**:
1. **信号预检**: 开始前检测GPS信号质量，给用户预期
2. **后台保活**: 锁屏、切换应用时持续记录
3. **照片标记**: 拍照自动关联GPS坐标，形成"脚印"
4. **异常保护**: 异常退出自动保存已记录部分

---

### 2.5 分享流程

```mermaid
flowchart TD
    A[触发分享] --> B{分享场景}
    
    B -->|路线分享| C[路线详情页分享]
    B -->|行程分享| D[导航前分享]
    B -->|记录分享| E[轨迹记录完成后]
    
    C --> F[生成路线卡片]
    D --> G[生成行程卡片]
    E --> H[生成记录卡片]
    
    F --> I[卡片内容]
    G --> I
    H --> I
    
    I --> J[自动选图]
    I --> K[叠加路线数据]
    I --> L[应用分享模板]
    
    J --> M[预览分享卡片]
    K --> M
    L --> M
    
    M --> N{编辑选项}
    
    N -->|更换图片| O[从相册选择]
    O --> P[调整图片位置]
    P --> M
    
    N -->|编辑文字| Q[修改描述]
    Q --> M
    
    N -->|选择模板| R[切换模板样式]
    R --> M
    
    N -->|确认分享| S{分享渠道}
    
    S -->|微信好友| T[调起微信分享]
    S -->|朋友圈| U[生成朋友圈图片]
    S -->|保存本地| V[保存到相册]
    
    T --> W[分享成功]
    U --> W
    V --> W
    
    W --> X[返回APP]
```

**流程说明**:
1. **一键生成**: 自动选图+数据叠加+模板应用，降低创作门槛
2. **三种场景**: 路线分享（发现好路线）、行程分享（安全告知）、记录分享（成就展示）
3. **模板选择**: 提供多种风格模板（简约/户外/文艺）

---

### 2.6 用户注册/登录流程

```mermaid
flowchart TD
    A[触发登录] --> B{登录方式}
    
    B -->|微信登录| C[调起微信授权]
    C --> D{授权结果}
    
    D -->|同意| E[获取微信用户信息]
    E --> F{是否新用户?}
    
    F -->|新用户| G[创建用户账号]
    G --> H[生成用户ID]
    H --> I[设置默认昵称头像]
    I --> J[返回登录成功]
    
    F -->|老用户| K[查询用户信息]
    K --> L[更新登录时间]
    L --> J
    
    D -->|拒绝| M[提示授权失败]
    M --> N[提供重试选项]
    N --> C
    
    B -->|手机号登录| O[输入手机号]
    O --> P[获取验证码]
    P --> Q[输入验证码]
    Q --> R{验证结果}
    
    R -->|成功| S[登录/注册成功]
    S --> J
    
    R -->|失败| T[提示验证码错误]
    T --> U[允许重新输入]
    U --> Q
    
    J --> V[保存登录态]
    V --> W[7天免登录]
    W --> X[返回原页面]
    
    X --> Y{后续引导}
    
    Y -->|新用户首次| Z[引导设置紧急联系人]
    Y -->|正常流程| AA[继续原操作]
```

**流程说明**:
1. **微信优先**: 主推微信一键登录，降低门槛
2. **手机号备选**: 提供手机号登录作为备选方案
3. **新用户识别**: 自动识别新老用户，新用户引导设置紧急联系人
4. **登录态持久**: 7天免登录，减少重复登录打扰

---

## 3. 用户流程详细说明

### 3.1 流程决策点汇总

| 决策点 | 场景 | 默认选项 | 说明 |
|--------|------|----------|------|
| 登录触发 | 需要个性化功能时 | 游客模式 | 浏览功能无需登录 |
| 离线包下载 | 首次导航前 | 自动下载 | 可手动取消，但会提示风险 |
| 紧急联系人 | 首次导航前 | 强制设置 | 至少1位，最多3位 |
| 行程分享 | 导航开始前 | 推荐分享 | 可跳过，但会提示安全建议 |
| 偏航处理 | 偏离路线时 | 自动提醒 | 30m震动提醒，50m重新规划 |

### 3.2 异常流程处理

| 异常场景 | 处理方式 | 用户提示 |
|----------|----------|----------|
| 网络中断 | 使用缓存数据，提示离线模式 | "当前处于离线模式，部分功能受限" |
| GPS信号弱 | 提示信号弱，建议开阔地带 | "GPS信号较弱，请前往开阔地带" |
| 离线包损坏 | 提示重新下载 | "离线包损坏，请重新下载" |
| 存储空间不足 | 提示清理空间 | "存储空间不足，请清理后重试" |
| 电量低(<20%) | 提示省电模式 | "电量较低，已开启省电模式" |

### 3.3 关键路径时长预估

| 路径 | 步骤数 | 预估时长 | 优化目标 |
|------|--------|----------|----------|
| 发现→开始导航 | 5步 | <2分钟 | 减少下载等待 |
| 登录→设置紧急联系人 | 3步 | <1分钟 | 简化表单填写 |
| 开始记录→保存 | 3步 | 用户决定 | 后台自动处理 |
| 生成分享图→分享 | 2步 | <30秒 | 一键生成优化 |

---

## 4. 流程图与PRD对应关系

| 流程图 | PRD用户故事 | 验收标准关联 |
|--------|-------------|--------------|
| 新用户首次使用流程 | US-001, US-008 | 首页显示、微信登录 |
| 路线发现流程 | US-001, US-002 | 路线列表、路线详情 |
| 路线导航流程 | US-003, US-004, US-006, US-007 | 离线包、导航、SOS、分享 |
| 轨迹记录流程 | US-101 | 轨迹记录、照片标记 |
| 分享流程 | US-007, US-102 | 行程分享、一键生成分享图 |
| 用户注册/登录流程 | US-008 | 微信登录、登录状态持久化 |

---

## 5. 附录

### 5.1 流程图符号说明

| 符号 | 含义 | 使用场景 |
|------|------|----------|
| 矩形 | 操作/处理 | 用户操作或系统处理 |
| 菱形 | 判断/决策 | 条件分支 |
| 圆角矩形 | 开始/结束 | 流程起点和终点 |
| 平行四边形 | 输入/输出 | 数据输入或输出 |
| 箭头 | 流程方向 | 流程走向 |

### 5.2 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2026-02-27 | 初版完成，包含6个核心流程图 |

---

> **"安全第一，体验第二，功能第三"** - 每个流程设计都需优先考虑用户安全
