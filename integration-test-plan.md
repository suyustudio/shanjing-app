# Q4 集成测试方案

## 测试场景：用户完整流程

### 场景描述
用户从注册到收藏路线的完整业务流程，验证各接口数据传递正确性。

### 测试步骤

| 步骤 | 操作 | 验证点 |
|------|------|--------|
| 1 | 用户注册 | 返回 user_id，数据库写入正确 |
| 2 | 用户登录 | 返回有效 token，token 可解码 |
| 3 | 浏览路线列表 | 返回路线数据，格式正确 |
| 4 | 收藏路线 | 收藏成功，关联数据正确 |

### 接口串联验证

```
POST /auth/register/phone
    ↓ 返回 user_id
POST /api/login
    ↓ 返回 token
GET  /trails (Header: Authorization: Bearer {token})
    ↓ 返回 route_id
POST /api/favorites (Header: Authorization: Bearer {token})  ⚠️ 尚未实现
    Body: { "route_id": "xxx" }
```

### 数据传递检查

| 数据项 | 来源 | 传递目标 | 验证方式 |
|--------|------|----------|----------|
| user_id | 注册响应 | 登录请求 | 日志/数据库比对 |
| token | 登录响应 | 后续请求 Header | 解码验证 payload |
| route_id | 路线列表 | 收藏请求 | 请求参数匹配 |

### 通过标准

1. 全流程无报错，HTTP 状态码 200
2. 各环节数据正确传递，无丢失或篡改
3. 最终收藏记录关联正确的 user_id 和 route_id

### 测试数据

- 用户名: `test_user_${timestamp}`
- 密码: `Test@1234`
- 路线: 列表中第一条

## 测试场景：端到端用户旅程

### 场景描述
完整用户旅程：注册 → 登录 → 搜索路线 → 查看详情 → 收藏 → 查看收藏列表，验证数据一致性。

### 测试步骤

| 步骤 | 操作 | 验证点 |
|------|------|--------|
| 1 | 用户注册 | 返回 user_id，数据库写入正确 |
| 2 | 用户登录 | 返回有效 token |
| 3 | 搜索路线 | 返回路线列表，包含 route_id |
| 4 | 查看路线详情 | 返回路线完整信息，与列表数据一致 |
| 5 | 收藏路线 | 收藏成功，返回收藏记录 |
| 6 | 查看收藏列表 | 列表包含刚收藏的路线 |

### 数据一致性验证

| 检查点 | 验证内容 |
|--------|----------|
| 用户数据 | 注册 user_id 与收藏关联 user_id 一致 |
| 路线数据 | 搜索结果、详情、收藏列表中的 route 信息一致 |
| 收藏状态 | 收藏后列表立即显示，无延迟 |
| 端到端闭环 | 全流程使用同一 token，无重新登录 |

### 通过标准

1. 6 步流程连续完成，无中断
2. 各阶段数据一致，无信息丢失
3. 收藏列表实时反映操作结果

---
*极简集成测试方案 - Week 4 Day 4*
