# Product Agent Review: 轨迹跟随算法调研

**Review Date**: 2026-02-28  
**Reviewed By**: Product Agent  
**Source Doc**: flutter-navigation-algorithm.md

---

## 1. 技术可行性评估

### 1.1 几何匹配方案（方案 B）

| 维度 | 评估 | 说明 |
|------|------|------|
| **可行性** | ✅ **可落地** | 最近点投影法逻辑清晰，Flutter 有成熟库支持 |
| **实现难度** | 低 | 仅需计算点到线段的距离，无需复杂路网数据 |
| **依赖** | 少 | 仅需预加载路线 Polyline，不依赖第三方服务 |

**结论**：几何匹配方案在技术上完全可行，适合作为 MVP 首选。

### 1.2 服务端 Map Matching（方案 A）

| 维度 | 评估 | 说明 |
|------|------|------|
| **可行性** | ✅ **可落地** | Mapbox/OSRM 都是成熟服务 |
| **依赖风险** | 中 | 需评估 Mapbox 国内可用性、OSRM 自建成本 |

**建议**：需要确认 Mapbox 在国内的访问稳定性，或准备 OSRM 自建方案。

---

## 2. 精度要求评估

### 2.1 <10米误差是否满足产品需求？

| 场景 | 10米误差影响 | 是否可接受 |
|------|-------------|-----------|
| **城市步行导航** | 可能匹配到相邻街道 | ⚠️ 边缘可接受 |
| **景区/园区导航** | 路线相对简单，误差影响小 | ✅ 可接受 |
| **复杂路口** | 可能误判转向时机 | ❌ 需优化 |
| **轨迹回放** | 视觉上有偏移 | ⚠️ 可接受 |

**产品建议**：
- **MVP 阶段**：10米误差可接受，优先保证功能可用
- **后续优化**：复杂路口场景需要结合方向角判断，或切换到服务端方案

### 2.2 误差计算方案

调研文档中提供的 Haversine + MAE/RMSE 方案合理，但建议补充：
- **视觉误差**：用户感知的偏移距离（与地图缩放级别相关）
- **业务误差**：是否偏离预定路线的判定阈值

---

## 3. 实现复杂度评估

### 3.1 Week 5 完成可行性

| 方案 | 预估工时 | Week 5 可行性 |
|------|---------|--------------|
| **方案 B（客户端几何匹配）** | 2-3 天 | ✅ **可行** |
| **方案 A（服务端 Map Matching）** | 3-4 天 | ⚠️ 较紧张 |
| **方案 C（卡尔曼滤波）** | 5-7 天 | ❌ 不可行 |

**建议执行顺序**：
1. **Week 5 目标**：完成方案 B（客户端几何匹配）
2. **Week 6 扩展**：根据实际精度表现，决定是否接入方案 A

### 3.2 关键任务拆解

```
Day 1-2: GPS 采集 + 精度过滤
Day 3-4: Polyline 匹配算法实现
Day 5:   集成测试 + 误差统计
```

---

## 4. 风险识别

### 4.1 技术风险

| 风险 | 等级 | 描述 | 缓解措施 |
|------|------|------|---------|
| **GPS 漂移** | 中 | 城市峡谷、室内场景 GPS 精度下降 | 增加精度过滤，低于阈值时不匹配 |
| **复杂路口** | 中 | 多路口交汇时几何匹配可能出错 | 结合方向角判断，或降低匹配敏感度 |
| **路线交叉** | 低 | 立交桥、下穿道等立体交叉 | 短期内可忽略，后续考虑海拔数据 |
| **性能问题** | 低 | 高频 GPS 点计算量大 | 可降采样或空间索引优化 |

### 4.2 产品风险

| 风险 | 等级 | 描述 | 缓解措施 |
|------|------|------|---------|
| **用户体验** | 中 | 10米误差在视觉上可能明显 | 增加"吸附"效果，平滑过渡 |
| **离线场景** | 低 | 方案 B 离线可用，但方案 A 不可 | MVP 阶段方案 B 已足够 |

---

## 5. 结论与建议

### 5.1 总体评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 技术可行性 | ⭐⭐⭐⭐⭐ | 方案成熟，可快速落地 |
| 精度满足度 | ⭐⭐⭐⭐ | 10米误差基本满足，复杂场景需优化 |
| 实现复杂度 | ⭐⭐⭐⭐⭐ | 方案 B 可在 Week 5 完成 |
| 风险可控性 | ⭐⭐⭐⭐ | 主要风险已知，有缓解措施 |

### 5.2 产品建议

1. **采用方案 B 作为 MVP 实现**
   - 理由：快速落地，离线可用，满足基础需求

2. **精度验收标准**
   - 平均误差 < 10m（MAE）
   - 95% 点位误差 < 20m
   - 最大误差 < 50m（异常情况）

3. **后续迭代方向**
   - Phase 2：接入服务端 Map Matching（方案 A）提升复杂场景精度
   - Phase 3：考虑卡尔曼滤波（方案 C）优化运动场景体验

4. **需要补充的工作**
   - [ ] 确认 Mapbox 国内可用性（为方案 A 做准备）
   - [ ] 设计误差统计埋点，用于后续优化
   - [ ] 定义"偏离路线"的业务判定逻辑

---

**Review 结论**：Dev Agent 的调研结论合理，建议按方案 B 推进 Week 5 开发。
