# Flutter 导航界面联调测试方案

## 概述

本方案针对 M8.5 Flutter 导航界面进行联调测试，覆盖轨迹匹配算法、导航流程集成及模拟测试数据。

---

## 1. 单元测试：轨迹匹配算法

### 1.1 测试目标

验证 GPS 坐标与预设路线的匹配准确性。

### 1.2 测试用例

| 用例ID | 描述 | 输入 | 预期结果 |
|--------|------|------|----------|
| UT-001 | 精确匹配 | 坐标在路线上 | 匹配成功，偏差=0 |
| UT-002 | 轻微偏离 | 坐标偏离路线<10m | 匹配最近点，记录偏差 |
| UT-003 | 严重偏离 | 坐标偏离路线>50m | 触发偏航警告 |
| UT-004 | 信号丢失 | 连续3点无信号 | 使用插值估算位置 |
| UT-005 | 路线切换 | 接近岔路口 | 正确识别目标分支 |

### 1.3 关键指标

- 匹配精度：±5m
- 响应时间：<100ms
- 偏航检测：>30m 触发

---

## 2. 集成测试：导航流程

### 2.1 测试场景

| 场景ID | 流程 | 检查点 |
|--------|------|--------|
| IT-001 | 启动导航 | 地图加载、路线渲染、语音初始化 |
| IT-002 | 正常行驶 | 位置更新、箭头跟随、语音播报 |
| IT-003 | 偏航重算 | 自动重新规划、新路线提示 |
| IT-004 | 到达终点 | 结束提示、统计展示 |
| IT-005 | 后台切换 | 定位持续、通知栏状态 |
| IT-006 | 网络中断 | 离线地图、缓存路线 |

### 2.2 状态流转

```
[初始化] → [定位中] → [导航中] → [偏航] → [重算] → [导航中] → [到达]
              ↓           ↓         ↓
           [失败]     [暂停]    [取消]
```

---

## 3. 模拟数据：测试路线坐标

### 3.1 测试路线 A（直线道路）

```json
{
  "name": "直线测试路",
  "points": [
    {"lat": 39.9042, "lng": 116.4074, "timestamp": 0},
    {"lat": 39.9050, "lng": 116.4074, "timestamp": 10},
    {"lat": 39.9060, "lng": 116.4074, "timestamp": 20},
    {"lat": 39.9070, "lng": 116.4074, "timestamp": 30}
  ]
}
```

### 3.2 测试路线 B（十字路口）

```json
{
  "name": "十字路口测试",
  "points": [
    {"lat": 39.9100, "lng": 116.4100},
    {"lat": 39.9100, "lng": 116.4110},
    {"lat": 39.9100, "lng": 116.4120}
  ],
  "branches": [
    {"lat": 39.9100, "lng": 116.4120, "to": "左转", "target": [39.9110, 116.4120]},
    {"lat": 39.9100, "lng": 116.4120, "to": "直行", "target": [39.9100, 116.4130]},
    {"lat": 39.9100, "lng": 116.4120, "to": "右转", "target": [39.9090, 116.4120]}
  ]
}
```

### 3.3 测试路线 C（偏航场景）

```json
{
  "name": "偏航测试",
  "route": [
    {"lat": 39.9000, "lng": 116.4000},
    {"lat": 39.9010, "lng": 116.4000},
    {"lat": 39.9020, "lng": 116.4000}
  ],
  "deviation": [
    {"lat": 39.9010, "lng": 116.4000},
    {"lat": 39.9010, "lng": 116.4050},
    {"lat": 39.9010, "lng": 116.4100}
  ]
}
```

---

## 4. 测试执行

### 4.1 命令

```bash
# 单元测试
flutter test test/navigation/matching_test.dart

# 集成测试
flutter test integration_test/navigation_flow_test.dart

# 带模拟数据
flutter test --dart-define=TEST_DATA=mock_routes.json
```

### 4.2 检查清单

- [ ] 单元测试通过率 100%
- [ ] 集成测试全部场景通过
- [ ] 模拟数据加载正常
- [ ] 性能指标达标

---

## 5. 输出物

| 文件 | 说明 |
|------|------|
| `test/matching_test.dart` | 轨迹匹配单元测试 |
| `integration_test/nav_flow_test.dart` | 导航流程集成测试 |
| `test/data/mock_routes.json` | 模拟路线数据 |
| `test_report.md` | 测试报告 |

---

*版本: v1.0 | 日期: 2026-02-28*
