# 山径APP - Phase 2 详细任务拆分（Week 2 技术验证）

> **文档版本**: v1.0  
> **最后更新**: 2026-02-27  
> **文档状态**: 评审中  
> **对应PRD**: shanjing-prd-v1.2.md  
> **对应任务总表**: shanjing-m1-tasks-v1.2.md  
> **前置文档**: shanjing-phase1-detailed.md

---

## 概述

本文档将 Phase 2（技术验证 Week 2）的 V1-V2 两个任务细化为可执行的具体动作，包含详细步骤、测试用例、验收标准、交付物格式、负责人和工期。

**关键决策点**: Week 2结束时必须确定技术方案可行性，如果高德SDK不满足离线导航需求，需立即切换至Mapbox或调整M1范围。

---

## V1: 高德SDK离线导航验证

### 基本信息
- **任务ID**: V1
- **工期**: 3天
- **负责人**: 移动端工程师
- **前置依赖**: 无（可与Phase 1并行启动）
- **优先级**: P0
- **决策影响**: 如验证不通过，整个项目技术方案需调整

### 验证目标
验证高德地图SDK在以下关键场景的可行性：
1. 离线地图下载与存储
2. 无网络环境下的地图渲染与定位
3. 轨迹跟随与偏航检测
4. 定位精度与性能表现

---

### 详细步骤

#### Day 1: 环境搭建与基础功能验证

**上午（4小时）：开发环境准备**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 1.1 | 创建Flutter测试项目 `shanjing-tech-verify` | 项目代码库 | 项目可正常编译运行 |
| 1.2 | 集成高德地图Flutter插件 `amap_flutter_map` | pubspec.yaml配置 | 插件版本≥3.0.0 |
| 1.3 | 申请高德开发者账号，创建测试应用 | 应用Key（Android/iOS） | Key申请通过，配额充足 |
| 1.4 | 配置AndroidManifest.xml和Info.plist | 配置文件 | 包含定位权限、API Key |
| 1.5 | 编写基础地图显示页面 | lib/pages/map_basic.dart | 地图可正常显示 |

**下午（4小时）：离线地图下载功能验证**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 2.1 | 研究高德离线地图API文档 | 技术笔记 | 明确离线地图下载接口 |
| 2.2 | 实现离线地图城市列表获取 | 城市选择页面 | 可获取支持离线的城市列表 |
| 2.3 | 实现离线地图下载功能 | 下载管理页面 | 支持开始/暂停/继续下载 |
| 2.4 | 实现下载进度监听与显示 | 进度UI组件 | 进度更新频率≤1秒 |
| 2.5 | 测试断点续传功能 | 测试记录 | 中断后可从断点继续 |

#### Day 2: 离线导航核心功能验证

**上午（4小时）：无网络环境地图测试**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 3.1 | 下载测试区域离线地图（杭州市区+西湖山区） | 离线地图数据包 | 包含14-15级精度 |
| 3.2 | 开启手机飞行模式，验证地图显示 | 测试视频/截图 | 地图可正常渲染，无空白 |
| 3.3 | 测试地图缩放、平移、旋转操作 | 操作记录 | 操作流畅，无明显卡顿 |
| 3.4 | 测试POI显示（卫生间、补给点等） | POI显示截图 | POI图标正常显示 |
| 3.5 | 记录离线地图数据包大小 | 数据记录表 | 符合5-20MB/路线预期 |

**下午（4小时）：定位与轨迹跟随验证**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 4.1 | 集成高德定位SDK，配置定位参数 | 定位服务类 | 定位间隔1秒，高精度模式 |
| 4.2 | 实现GPS坐标实时获取与显示 | 定位测试页面 | 坐标更新频率1Hz |
| 4.3 | 模拟轨迹数据，实现轨迹绘制 | 轨迹绘制功能 | 轨迹线平滑显示 |
| 4.4 | 实现轨迹跟随：GPS点匹配到最近轨迹点 | 轨迹跟随算法 | 匹配误差<10米 |
| 4.5 | 实现用户位置在轨迹上的实时显示 | 导航UI组件 | 位置标记跟随用户移动 |

#### Day 3: 偏航检测与性能测试

**上午（4小时）：偏航检测与提醒**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 5.1 | 实现偏航检测算法（计算GPS点与轨迹距离） | 偏航检测类 | 可计算垂直距离 |
| 5.2 | 设置偏航阈值：30米提醒，50米重新规划 | 配置参数 | 阈值可配置 |
| 5.3 | 实现偏航提醒UI（弹窗+震动） | 提醒组件 | 偏航时触发提醒 |
| 5.4 | 实地测试偏航检测（模拟偏离路线） | 实地测试记录 | 实际测试验证 |
| 5.5 | 测试重新规划路线功能 | 重规划功能 | 可生成新路线（如支持） |

**下午（4小时）：性能测试与文档整理**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 6.1 | 测试离线地图加载时间 | 性能测试数据 | 加载时间<2秒 |
| 6.2 | 测试定位精度（与标准GPS对比） | 精度对比表 | 精度<10米（开阔地） |
| 6.3 | 测试连续导航1小时稳定性 | 稳定性报告 | 无崩溃、无内存泄漏 |
| 6.4 | 整理测试数据，撰写技术报告 | V1技术验证报告 | 报告完整 |
| 6.5 | 团队评审会议 | 评审会议纪要 | 决策通过/不通过 |

---

### 测试用例清单

#### TC-V1-01: 离线地图下载
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-01-01 | 城市列表获取 | 调用获取离线地图城市列表接口 | 返回支持离线的城市列表 | P0 |
| TC-V1-01-02 | 离线地图下载 | 选择杭州市，点击下载 | 开始下载，进度条更新 | P0 |
| TC-V1-01-03 | 断点续传 | 下载过程中断网，恢复后继续 | 从断点继续下载，不重复 | P0 |
| TC-V1-01-04 | 存储空间检查 | 存储不足时尝试下载 | 提示存储空间不足 | P1 |
| TC-V1-01-05 | 下载完成验证 | 下载完成后检查本地文件 | 文件存在，大小符合预期 | P0 |

#### TC-V1-02: 无网络地图显示
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-02-01 | 飞行模式地图显示 | 开启飞行模式，打开地图 | 地图正常显示，无空白区域 | P0 |
| TC-V1-02-02 | 地图缩放操作 | 离线状态下缩放地图 | 缩放流畅，瓦片正常加载 | P0 |
| TC-V1-02-03 | 地图平移操作 | 离线状态下平移地图 | 平移流畅，无卡顿 | P1 |
| TC-V1-02-04 | POI显示 | 离线状态下查看POI | POI图标正常显示 | P1 |
| TC-V1-02-05 | 地图加载时间 | 记录从点击到完全显示时间 | < 2秒 | P0 |

#### TC-V1-03: 定位精度
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-03-01 | 开阔地带定位 | 在开阔地带记录GPS坐标 | 精度<10米 | P0 |
| TC-V1-03-02 | 树荫下定位 | 在树荫下记录GPS坐标 | 精度<15米 | P0 |
| TC-V1-03-03 | 峡谷定位 | 在山谷/峡谷记录GPS坐标 | 精度<20米 | P1 |
| TC-V1-03-04 | 定位更新频率 | 记录1秒内坐标更新次数 | ≥1次/秒 | P0 |
| TC-V1-03-05 | 双模定位 | 检查北斗+GPS双模支持 | 支持双模（如设备支持） | P1 |

#### TC-V1-04: 轨迹跟随
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-04-01 | 轨迹匹配 | 沿规划路线行走，观察位置显示 | 位置标记在轨迹线上 | P0 |
| TC-V1-04-02 | 匹配精度 | 记录GPS点与轨迹线距离 | 匹配误差<10米 | P0 |
| TC-V1-04-03 | 实时更新 | 快速移动时观察位置更新 | 位置实时跟随，无明显延迟 | P0 |
| TC-V1-04-04 | 轨迹绘制 | 显示规划轨迹线 | 轨迹线清晰、连续 | P1 |

#### TC-V1-05: 偏航检测
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-05-01 | 30米偏航提醒 | 故意偏离路线30米 | 触发偏航提醒（震动+弹窗） | P0 |
| TC-V1-05-02 | 50米偏航重规划 | 继续偏离至50米 | 提示重新规划路线 | P0 |
| TC-V1-05-03 | 回到路线 | 偏航后返回原路线 | 偏航提醒消失，恢复正常 | P0 |
| TC-V1-05-04 | 误报率 | 正常行走记录偏航次数 | 正常行走不误报 | P0 |

#### TC-V1-06: 性能与稳定性
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V1-06-01 | 连续运行1小时 | 持续导航1小时 | 无崩溃、无ANR | P0 |
| TC-V1-06-02 | 内存占用 | 监控导航过程中内存使用 | 内存占用<200MB | P1 |
| TC-V1-06-03 | CPU占用 | 监控导航过程中CPU使用 | CPU占用<30% | P1 |
| TC-V1-06-04 | 离线包大小 | 测量单条路线离线数据大小 | 5-20MB/路线 | P0 |

---

### 验收标准

#### 通过标准（必须全部满足）
- [ ] 离线地图下载功能正常，支持断点续传
- [ ] 无网络环境下地图可正常显示，加载时间<2秒
- [ ] GPS定位精度<10米（开阔地带）
- [ ] 轨迹跟随功能准确，匹配误差<10米
- [ ] 偏航检测准确，30米触发提醒，50米提示重规划
- [ ] 连续导航1小时无崩溃、无内存泄漏
- [ ] 单条路线离线数据大小5-20MB

#### 不通过标准（满足任一即判定不通过）
- [ ] 离线地图无法下载或下载后无法显示
- [ ] 无网络环境下地图显示异常（空白、瓦片缺失）
- [ ] 定位精度>20米（无法满足导航需求）
- [ ] 轨迹跟随误差>30米（频繁误报偏航）
- [ ] 连续运行30分钟内出现崩溃或ANR
- [ ] 离线数据大小>50MB/路线（存储压力过大）

#### 有条件通过（需备注限制）
- [ ] 部分区域地图数据缺失（需明确覆盖范围）
- [ ] 特定场景定位精度下降（需明确场景）
- [ ] 某些功能需在线支持（需明确功能列表）

---

### 交付物

**1. 技术验证代码**
- 路径: `tech-verify/v1-amap-offline/`
- 内容:
```
v1-amap-offline/
├── android/              # Android工程
├── ios/                  # iOS工程
├── lib/
│   ├── main.dart
│   ├── pages/
│   │   ├── map_basic.dart      # 基础地图
│   │   ├── offline_download.dart  # 离线下载
│   │   ├── navigation_test.dart   # 导航测试
│   │   └── location_test.dart     # 定位测试
│   ├── services/
│   │   ├── map_service.dart       # 地图服务
│   │   ├── location_service.dart  # 定位服务
│   │   └── navigation_service.dart # 导航服务
│   └── utils/
│       └── gps_utils.dart
├── test/
│   └── navigation_test.dart
└── README.md
```

**2. V1技术验证报告**
- 文件: `docs/phase2/V1-高德SDK离线导航验证报告.md`
- 内容结构:
```markdown
# V1 高德SDK离线导航验证报告

## 1. 测试环境
- 测试设备: （型号、系统版本）
- 高德SDK版本: 
- 测试时间: 
- 测试地点: 

## 2. 功能验证结果

### 2.1 离线地图下载
| 测试项 | 结果 | 备注 |
|--------|------|------|
| 城市列表获取 | ✅通过/❌不通过 | |
| 离线地图下载 | ✅通过/❌不通过 | |
| 断点续传 | ✅通过/❌不通过 | |
| 存储空间检查 | ✅通过/❌不通过 | |

### 2.2 无网络地图显示
| 测试项 | 结果 | 数据 |
|--------|------|------|
| 飞行模式显示 | ✅通过/❌不通过 | |
| 地图加载时间 | ✅通过/❌不通过 | 实测: X秒 |
| 缩放平移操作 | ✅通过/❌不通过 | |
| POI显示 | ✅通过/❌不通过 | |

### 2.3 定位精度
| 测试场景 | 精度 | 结果 |
|----------|------|------|
| 开阔地带 | X米 | ✅通过/❌不通过 |
| 树荫下 | X米 | ✅通过/❌不通过 |
| 峡谷 | X米 | ✅通过/❌不通过 |

### 2.4 轨迹跟随
| 测试项 | 结果 | 数据 |
|--------|------|------|
| 轨迹匹配 | ✅通过/❌不通过 | |
| 匹配精度 | ✅通过/❌不通过 | 实测: X米 |
| 实时更新 | ✅通过/❌不通过 | |

### 2.5 偏航检测
| 测试项 | 结果 | 备注 |
|--------|------|------|
| 30米提醒 | ✅通过/❌不通过 | |
| 50米重规划 | ✅通过/❌不通过 | |
| 误报率 | ✅通过/❌不通过 | 误报次数: X |

### 2.6 性能与稳定性
| 测试项 | 结果 | 数据 |
|--------|------|------|
| 1小时稳定性 | ✅通过/❌不通过 | |
| 内存占用 | ✅通过/❌不通过 | 峰值: X MB |
| 离线包大小 | ✅通过/❌不通过 | 大小: X MB |

## 3. 问题与限制
- 问题1: （描述）
- 问题2: （描述）
- 限制1: （描述）

## 4. 结论
**综合判定**: ✅验证通过 / ❌验证不通过 / ⚠️有条件通过

**建议**:
- 如通过: 继续采用高德SDK方案
- 如不通过: 建议切换至Mapbox/调整M1范围

## 5. 附录
- 测试截图
- 测试视频
- 原始数据
```

**3. 测试数据记录表**
- 文件: `docs/phase2/V1-测试数据记录.xlsx`
- 包含: 所有测试用例的原始数据记录

---

## V2: Flutter后台GPS保活测试

### 基本信息
- **任务ID**: V2
- **工期**: 2天
- **负责人**: 移动端工程师
- **前置依赖**: V1（需先确认定位功能正常）
- **优先级**: P0
- **决策影响**: 如后台保活不达标，需调研替代方案或调整产品预期

### 验证目标
验证Flutter应用在后台状态下的GPS保活能力：
1. 后台持续记录GPS不中断
2. 锁屏状态下继续工作
3. 主流品牌手机兼容性
4. 电量消耗可接受

---

### 详细步骤

#### Day 1: 后台定位实现与基础测试

**上午（4小时）：后台定位服务实现**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 1.1 | 研究Flutter后台定位方案 | 技术调研文档 | 明确可行方案 |
| 1.2 | 集成 `flutter_background_service` 插件 | pubspec.yaml配置 | 插件配置正确 |
| 1.3 | 集成 `geolocator` 或 `location` 插件 | 定位插件配置 | 支持后台定位 |
| 1.4 | 实现后台服务启动/停止逻辑 | 后台服务类 | 服务可正常启停 |
| 1.5 | 实现后台GPS数据采集 | 数据采集服务 | 后台持续获取GPS |
| 1.6 | 实现数据本地存储（SQLite） | 数据库服务 | 坐标点持久化存储 |

**下午（4小时）：基础功能测试**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 2.1 | 测试前台定位记录 | 测试记录 | 前台记录正常 |
| 2.2 | 测试切换到后台后的定位记录 | 测试记录 | 后台继续记录 |
| 2.3 | 测试锁屏状态下的定位记录 | 测试记录 | 锁屏继续记录 |
| 2.4 | 测试杀进程后恢复（如支持） | 测试记录 | 记录恢复情况 |
| 2.5 | 记录后台定位频率 | 频率测试数据 | 1点/秒 |

#### Day 2: 多品牌兼容性与电量测试

**上午（4小时）：多品牌手机测试**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 3.1 | 华为/荣耀手机测试（HarmonyOS） | 华为测试报告 | 后台定位正常 |
| 3.2 | 小米手机测试（MIUI/HyperOS） | 小米测试报告 | 后台定位正常 |
| 3.3 | OPPO手机测试（ColorOS） | OPPO测试报告 | 后台定位正常 |
| 3.4 | vivo手机测试（OriginOS） | vivo测试报告 | 后台定位正常 |
| 3.5 | 三星手机测试（OneUI） | 三星测试报告 | 后台定位正常 |

**下午（4小时）：电量消耗测试与报告整理**

| 步骤 | 具体动作 | 输出 | 验收标准 |
|------|----------|------|----------|
| 4.1 | 设计电量测试方案（控制变量） | 测试方案文档 | 方案可复现 |
| 4.2 | 1小时导航电量消耗测试（各品牌） | 电量消耗数据 | 记录耗电百分比 |
| 4.3 | 3小时连续导航电量测试 | 长时耗电数据 | 评估续航表现 |
| 4.4 | 对比测试：不开启导航的基准耗电 | 基准数据 | 计算净耗电 |
| 4.5 | 整理测试数据，撰写技术报告 | V2技术验证报告 | 报告完整 |
| 4.6 | 团队评审会议 | 评审会议纪要 | 决策通过/不通过 |

---

### 测试用例清单

#### TC-V2-01: 后台定位基础功能
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V2-01-01 | 前台定位 | 打开APP，开始记录，正常行走 | GPS点正常记录 | P0 |
| TC-V2-01-02 | 切换到后台 | 按Home键切换至后台，继续行走 | 后台继续记录GPS | P0 |
| TC-V2-01-03 | 锁屏定位 | 锁屏后继续行走5分钟 | 锁屏期间GPS持续记录 | P0 |
| TC-V2-01-04 | 解锁检查 | 解锁后查看记录轨迹 | 轨迹连续无中断 | P0 |
| TC-V2-01-05 | 后台时长测试 | 后台持续记录30分钟 | 30分钟内不中断 | P0 |
| TC-V2-01-06 | 数据完整性 | 检查后台记录的坐标点 | 无丢点，1点/秒 | P0 |

#### TC-V2-02: 多品牌兼容性测试
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V2-02-01 | 华为/荣耀 | 在华为手机上测试后台定位 | 后台定位正常 | P0 |
| TC-V2-02-02 | 小米 | 在小米手机上测试后台定位 | 后台定位正常 | P0 |
| TC-V2-02-03 | OPPO | 在OPPO手机上测试后台定位 | 后台定位正常 | P0 |
| TC-V2-02-04 | vivo | 在vivo手机上测试后台定位 | 后台定位正常 | P0 |
| TC-V2-02-05 | 三星 | 在三星手机上测试后台定位 | 后台定位正常 | P1 |
| TC-V2-02-06 | 系统杀进程 | 观察系统是否自动杀后台 | 记录杀进程情况 | P0 |
| TC-V2-02-07 | 电池优化 | 检查各品牌电池优化影响 | 记录需要关闭的优化项 | P0 |

#### TC-V2-03: 电量消耗测试
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V2-03-01 | 基准耗电 | 手机静置1小时，记录耗电 | 获得基准耗电率 | P0 |
| TC-V2-03-02 | 1小时导航耗电 | 开启导航1小时，记录耗电 | 耗电<15% | P0 |
| TC-V2-03-03 | 3小时导航耗电 | 开启导航3小时，记录耗电 | 耗电<40% | P0 |
| TC-V2-03-04 | 净耗电计算 | 导航耗电-基准耗电 | 净耗电<10%/小时 | P0 |
| TC-V2-03-05 | 不同品牌对比 | 同条件下测试各品牌耗电 | 记录品牌差异 | P1 |
| TC-V2-03-06 | 省电模式 | 开启手机省电模式后测试 | 记录耗电变化 | P1 |

#### TC-V2-04: 异常场景测试
| 用例ID | 测试项 | 测试步骤 | 预期结果 | 优先级 |
|--------|--------|----------|----------|--------|
| TC-V2-04-01 | 内存不足 | 模拟内存不足场景 | 记录是否被系统回收 | P1 |
| TC-V2-04-02 | 电量低 | 电量<20%时测试 | 记录系统行为 | P1 |
| TC-V2-04-03 | 权限被撤销 | 运行时撤销定位权限 | 优雅处理，提示用户 | P0 |
| TC-V2-04-04 | GPS信号丢失 | 进入室内/隧道 | 记录信号丢失处理 | P1 |
| TC-V2-04-05 | 网络切换 | 切换WiFi/移动数据 | 不影响GPS记录 | P1 |

---

### 验收标准

#### 通过标准（必须全部满足）
- [ ] 后台持续记录GPS不中断（30分钟测试通过）
- [ ] 锁屏状态下继续工作（5分钟测试通过）
- [ ] 主流品牌（华为/小米/OPPO/vivo）兼容性良好
- [ ] 1小时导航电量消耗<15%
- [ ] 数据完整性：1点/秒，无丢点

#### 不通过标准（满足任一即判定不通过）
- [ ] 后台定位在5分钟内被系统中断
- [ ] 主流品牌中超过2个品牌无法后台定位
- [ ] 1小时导航电量消耗>25%
- [ ] 后台记录丢点率>10%

#### 有条件通过（需备注限制）
- [ ] 部分品牌需要手动关闭电池优化（需提供设置指南）
- [ ] 长时间后台（>1小时）可能被系统清理（需提示用户）
- [ ] 特定系统版本存在兼容性问题（需明确版本范围）

---

### 手机品牌测试清单

| 品牌 | 系统 | 测试机型 | 后台定位 | 电量消耗(1h) | 特殊设置 | 结果 |
|------|------|----------|----------|--------------|----------|------|
| 华为 | HarmonyOS 4 | Mate 60 | ✅/❌ | X% | 需关闭电池优化 | |
| 华为 | HarmonyOS 3 | P60 | ✅/❌ | X% | 需关闭电池优化 | |
| 小米 | HyperOS | 小米14 | ✅/❌ | X% | 需开启自启动 | |
| 小米 | MIUI 14 | 小米13 | ✅/❌ | X% | 需开启自启动 | |
| OPPO | ColorOS 14 | Find X7 | ✅/❌ | X% | 需允许后台活动 | |
| OPPO | ColorOS 13 | Reno 11 | ✅/❌ | X% | 需允许后台活动 | |
| vivo | OriginOS 4 | X100 | ✅/❌ | X% | 需允许后台高耗电 | |
| vivo | OriginOS 3 | X90 | ✅/❌ | X% | 需允许后台高耗电 | |
| 三星 | OneUI 6 | S24 | ✅/❌ | X% | 需关闭电池优化 | |
| 荣耀 | MagicOS 8 | Magic 6 | ✅/❌ | X% | 需关闭电池优化 | |

---

### 电量消耗标准

| 场景 | 目标值 | 可接受值 | 不可接受值 |
|------|--------|----------|------------|
| 1小时导航 | < 10% | 10-15% | > 15% |
| 3小时导航 | < 30% | 30-40% | > 40% |
| 5小时导航 | < 50% | 50-60% | > 60% |

**测试条件**:
- 屏幕亮度: 50%
- 网络: 4G/5G（非WiFi）
- GPS: 高精度模式
- 其他: 关闭蓝牙、NFC
- 初始电量: 80%以上

---

### 交付物

**1. 技术验证代码**
- 路径: `tech-verify/v2-flutter-background-gps/`
- 内容:
```
v2-flutter-background-gps/
├── android/
├── ios/
├── lib/
│   ├── main.dart
│   ├── services/
│   │   ├── background_service.dart    # 后台服务
│   │   ├── location_service.dart      # 定位服务
│   │   └── database_service.dart      # 数据存储
│   ├── models/
│   │   └── location_point.dart        # 坐标点模型
│   └── pages/
│       ├── home_page.dart
│       └── track_record_page.dart
├── test/
└── README.md
```

**2. V2技术验证报告**
- 文件: `docs/phase2/V2-Flutter后台GPS保活测试报告.md`
- 内容结构:
```markdown
# V2 Flutter后台GPS保活测试报告

## 1. 测试环境
- 测试时间: 
- 测试地点: 
- Flutter版本: 
- 测试插件: 
  - flutter_background_service: X.X.X
  - geolocator: X.X.X

## 2. 后台定位功能验证

### 2.1 基础功能
| 测试项 | 结果 | 备注 |
|--------|------|------|
| 前台定位 | ✅通过/❌不通过 | |
| 后台定位 | ✅通过/❌不通过 | |
| 锁屏定位 | ✅通过/❌不通过 | |
| 30分钟持续 | ✅通过/❌不通过 | |
| 数据完整性 | ✅通过/❌不通过 | 丢点率: X% |

### 2.2 多品牌兼容性
| 品牌 | 机型 | 系统版本 | 后台定位 | 特殊设置 | 结果 |
|------|------|----------|----------|----------|------|
| 华为 | Mate 60 | HarmonyOS 4 | ✅/❌ | 需XXX | 通过/不通过 |
| 小米 | 小米14 | HyperOS | ✅/❌ | 需XXX | 通过/不通过 |
| OPPO | Find X7 | ColorOS 14 | ✅/❌ | 需XXX | 通过/不通过 |
| vivo | X100 | OriginOS 4 | ✅/❌ | 需XXX | 通过/不通过 |
| 三星 | S24 | OneUI 6 | ✅/❌ | 需XXX | 通过/不通过 |

### 2.3 电量消耗
| 测试项 | 基准耗电 | 导航耗电 | 净耗电 | 结果 |
|--------|----------|----------|--------|------|
| 1小时 | X% | X% | X% | ✅通过/❌不通过 |
| 3小时 | X% | X% | X% | ✅通过/❌不通过 |

## 3. 问题与限制
- 问题1: （描述）
- 限制1: （描述）

## 4. 品牌特定设置指南

### 华为/荣耀
1. 设置 → 电池 → 应用启动管理 → 找到山径APP → 手动管理
2. 允许自启动、允许关联启动、允许后台活动
3. 设置 → 应用和服务 → 应用管理 → 山径APP → 电池 → 启动管理 → 允许后台活动

### 小米
1. 设置 → 应用设置 → 应用管理 → 山径APP → 省电策略 → 无限制
2. 设置 → 应用设置 → 授权管理 → 自启动管理 → 允许山径APP

### OPPO
1. 设置 → 电池 → 应用耗电管理 → 山径APP → 允许完全后台行为
2. 允许自启动、允许关联启动

### vivo
1. 设置 → 电池 → 后台耗电管理 → 山径APP → 允许后台高耗电
2. 设置 → 应用与权限 → 权限管理 → 自启动 → 允许山径APP

## 5. 结论
**综合判定**: ✅验证通过 / ❌验证不通过 / ⚠️有条件通过

**建议**:
- 如通过: 继续采用当前方案
- 如不通过: 调研百度定位SDK/原生实现方案

## 6. 附录
- 测试截图
- 测试视频
- 原始数据
```

**3. 测试数据记录表**
- 文件: `docs/phase2/V2-测试数据记录.xlsx`
- 包含: 各品牌测试的原始数据记录

---

## 备选方案决策条件

### V1 高德SDK验证失败时的备选方案

| 方案 | 切换成本 | 风险评估 | 决策条件 |
|------|----------|----------|----------|
| **方案A: Mapbox** | 3-5天 | 国内数据一般，需翻墙 | 高德离线功能完全不可用 |
| **方案B: 在线导航优先** | 1-2天 | M1范围缩减，离线体验差 | 离线功能部分可用但不完善 |
| **方案C: 调整M1范围** | 0天 | 产品价值降低 | 技术风险过高，需保交付 |

**决策流程**:
```
V1验证结果
    │
    ├─ ✅ 通过 → 继续高德SDK方案
    │
    ├─ ⚠️ 有条件通过 → 评估限制是否可接受
    │              ├─ 可接受 → 继续高德方案，文档化限制
    │              └─ 不可接受 → 评估Mapbox
    │
    └─ ❌ 不通过 → 评估Mapbox（3天验证）
                   ├─ Mapbox通过 → 切换至Mapbox
                   └─ Mapbox不通过 → 方案B或C
```

### V2 后台保活验证失败时的备选方案

| 方案 | 切换成本 | 风险评估 | 决策条件 |
|------|----------|----------|----------|
| **方案A: 百度定位SDK** | 2-3天 | 保活能力较强 | Flutter插件保活不稳定 |
| **方案B: 原生Android实现** | 5-7天 | 保活能力强，成本高 | 百度SDK仍不满足 |
| **方案C: 降低保活预期** | 0天 | 需提示用户保持前台 | 技术风险过高 |

**决策流程**:
```
V2验证结果
    │
    ├─ ✅ 通过 → 继续Flutter方案
    │
    ├─ ⚠️ 有条件通过 → 提供用户设置指南
    │              └─ 文档化各品牌设置步骤
    │
    └─ ❌ 不通过 → 评估百度定位SDK（2天验证）
                   ├─ 百度SDK通过 → 切换至百度SDK
                   └─ 百度SDK不通过 → 评估原生实现或方案C
```

---

## Phase 2 整体时间线

```
Week 2:
周一  [V1-Day1] 环境搭建 + 离线地图下载验证
周二  [V1-Day2] 离线导航核心功能验证
周三  [V1-Day3] 偏航检测 + 性能测试 + V1报告
周四  [V2-Day1] 后台定位实现 + 基础测试
周五  [V2-Day2] 多品牌测试 + 电量测试 + V2报告

Week 2 周五下午: 技术验证评审会议
- 参与人: 全员
- 输出: 技术方案决策（继续/切换/调整）
```

---

## Phase 2 评审检查清单

### V1 评审要点
- [ ] 所有P0测试用例通过
- [ ] 离线地图功能满足PRD需求
- [ ] 定位精度达到<10米标准
- [ ] 偏航检测准确可用
- [ ] 性能表现可接受

### V2 评审要点
- [ ] 后台定位功能满足PRD需求
- [ ] 主流品牌兼容性良好
- [ ] 电量消耗可接受
- [ ] 已整理各品牌设置指南

### 决策评审
- [ ] V1验证结论明确（通过/不通过/有条件通过）
- [ ] V2验证结论明确（通过/不通过/有条件通过）
- [ ] 如需切换方案，已评估切换成本
- [ ] 团队对技术方案达成一致
- [ ] 已更新项目计划（如需要）

---

## 风险与应对

| 风险 | 概率 | 影响 | 应对措施 | 责任人 |
|------|------|------|----------|--------|
| 高德SDK离线功能不完善 | 中 | **极高** | 预留Mapbox备选，Week 2必须决策 | 移动端 |
| GPS后台保活问题 | 中 | 高 | 提前测试，调研百度定位SDK | 移动端 |
| 特定品牌兼容性问题 | 高 | 中 | 整理品牌设置指南，引导用户设置 | 移动端 |
| 电量消耗过高 | 中 | 高 | 优化定位频率，提供省电模式 | 移动端 |
| 测试设备不足 | 中 | 中 | 借用/租赁测试机，优先覆盖主流品牌 | PM |

---

## 交付物汇总

| 任务 | 交付物 | 路径 |
|------|--------|------|
| V1 | 技术验证代码 | `tech-verify/v1-amap-offline/` |
| V1 | 高德SDK离线导航验证报告 | `docs/phase2/V1-高德SDK离线导航验证报告.md` |
| V1 | 测试数据记录 | `docs/phase2/V1-测试数据记录.xlsx` |
| V2 | 技术验证代码 | `tech-verify/v2-flutter-background-gps/` |
| V2 | Flutter后台GPS保活测试报告 | `docs/phase2/V2-Flutter后台GPS保活测试报告.md` |
| V2 | 测试数据记录 | `docs/phase2/V2-测试数据记录.xlsx` |
| V2 | 品牌设置指南 | 包含在V2报告中 |

---

## 附录

### A. 参考文档
- PRD: `shanjing-prd-v1.2.md`
- 任务总表: `shanjing-m1-tasks-v1.2.md`
- Phase 1详细任务: `shanjing-phase1-detailed.md`

### B. 技术参考
- 高德地图Flutter插件: https://pub.dev/packages/amap_flutter_map
- 高德离线地图文档: https://lbs.amap.com/api/android-sdk/guide/map-map/offlinemap
- flutter_background_service: https://pub.dev/packages/flutter_background_service
- geolocator: https://pub.dev/packages/geolocator

### C. 测试设备建议
| 优先级 | 品牌 | 建议机型 | 理由 |
|--------|------|----------|------|
| P0 | 华为 | Mate 60 / P60 | 市场份额高，HarmonyOS代表 |
| P0 | 小米 | 小米14 / 13 | 年轻用户多，MIUI/HyperOS代表 |
| P0 | OPPO | Find X7 / Reno 11 | 女性用户多，ColorOS代表 |
| P0 | vivo | X100 / X90 | 线下市场高，OriginOS代表 |
| P1 | 荣耀 | Magic 6 | 华为系分支 |
| P1 | 三星 | S24 | 国际品牌代表 |

---

> **"技术验证是项目的保险栓"** - Week 2的严谨验证是避免后期返工的关键
