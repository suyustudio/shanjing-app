# Week 5 Day 4 Flutter 开发 Product Review 报告

**Review 日期**: 2026-02-28  
**Review 范围**: 发现页、地图页、导航页、我的页  
**Reviewer**: Product Agent

---

## 1. 发现页 (discovery_screen.dart)

### ✅ 功能完整性
| 需求项 | 状态 | 说明 |
|--------|------|------|
| 搜索功能 | ✅ 已实现 | 支持按路线名称搜索，实时过滤 |
| 标签筛选 | ✅ 已实现 | 支持按难度（简单/中等/困难）筛选 |
| 真实数据接入 | ✅ 已实现 | 从 `trails-all.json` 加载10条真实路线数据 |
| 路线卡片展示 | ✅ 已实现 | 显示图片、名称、距离、时长 |
| 点击进入详情 | ✅ 已实现 | 跳转到 `TrailDetailScreen` |

### 📊 数据流评估
- ✅ 使用 `DefaultAssetBundle` 正确加载本地 JSON 数据
- ✅ 状态管理使用 `setState`，适合当前页面复杂度
- ⚠️ **问题**: `RouteCard` 未显示难度标签，但筛选逻辑依赖难度字段

### 🎯 用户体验
- ✅ 加载状态显示 `CircularProgressIndicator`
- ✅ 空状态显示友好提示 "暂无符合条件的路线"
- ⚠️ **改进建议**: 路线卡片缺少难度标识，用户无法直观看到难度信息

### ⚠️ 风险点
| 风险 | 等级 | 说明 |
|------|------|------|
| 图片使用随机图片服务 | 中 | `picsum.photos` 是占位图服务，生产环境需替换为真实图片 |
| 无错误重试机制 | 低 | JSON 加载失败仅显示空列表，无重试按钮 |
| 难度映射硬编码 | 低 | `_getDifficultyText` 方法硬编码中英文映射 |

---

## 2. 地图页 (map_screen.dart)

### ✅ 功能完整性
| 需求项 | 状态 | 说明 |
|--------|------|------|
| 高德地图集成 | ✅ 已实现 | 使用 `amap_flutter_map` 插件 |
| 定位权限请求 | ✅ 已实现 | 使用 `permission_handler` 请求位置权限 |
| 标记点显示 | ✅ 已实现 | 3个固定路线标记点 |
| 轨迹绘制 | ✅ 已实现 | 33个坐标点绘制绿色轨迹线 |
| 卡片浮层 | ✅ 已实现 | 点击标记点显示路线信息卡片 |
| 搜索栏 | ⚠️ 部分实现 | UI 存在但仅打印日志，无实际搜索功能 |
| 标签筛选 | ⚠️ 部分实现 | UI 存在但未关联地图标记过滤 |

### 📊 数据流评估
- ⚠️ **问题**: 地图页使用硬编码的 `_routes` 数据，未与发现页共享真实数据
- ⚠️ **问题**: 轨迹坐标写死为 `trail-data-001.json` 的33个点，未动态加载
- ✅ 点击标记点正确传递数据到卡片浮层

### 🎯 用户体验
- ✅ 点击地图空白处可关闭卡片浮层
- ✅ 卡片浮层有 "查看详情" 按钮，可跳转到路线详情
- ⚠️ **问题**: 搜索和筛选标签无实际功能，用户会感到困惑
- ⚠️ **问题**: 地图初始位置固定为杭州西湖，未根据用户位置调整

### ⚠️ 风险点
| 风险 | 等级 | 说明 |
|------|------|------|
| 高德 API Key 硬编码 | **高** | API Key 明文存储在代码中，存在安全风险 |
| 地图数据与发现页不一致 | 中 | 用户可能在发现页看到路线，但地图上没有对应标记 |
| 无定位失败处理 | 中 | 权限被拒绝后无提示或引导 |
| 轨迹颜色固定 | 低 | 所有轨迹都是绿色，未根据难度变色 |

---

## 3. 导航页 (navigation_screen.dart)

### ✅ 功能完整性
| 需求项 | 状态 | 说明 |
|--------|------|------|
| 地图显示 | ✅ 已实现 | 显示高德地图和导航轨迹 |
| 路线名称显示 | ✅ 已实现 | 接收并显示传入的路线名称 |
| 导航状态提示 | ✅ 已实现 | 显示 "正在导航中..." |
| 结束导航 | ✅ 已实现 | 提供结束导航按钮 |

### 📊 数据流评估
- ✅ 正确接收 `routeName` 参数
- ⚠️ **问题**: 导航轨迹是硬编码的5个点，未根据实际路线动态绘制
- ⚠️ **问题**: 未接收路线坐标数据，无法实现真实导航

### 🎯 用户体验
- ✅ 底部卡片清晰显示导航信息
- ✅ 结束导航按钮使用醒目的红色
- ⚠️ **改进建议**: 缺少导航指引（如转向提示、剩余距离/时间）

### ⚠️ 风险点
| 风险 | 等级 | 说明 |
|------|------|------|
| API Key 重复硬编码 | **高** | 与地图页相同的安全风险 |
| 导航轨迹硬编码 | 中 | 所有路线显示相同的导航轨迹 |
| 无真实导航功能 | 中 | 仅显示地图，无语音导航、路径规划等 |

---

## 4. 我的页 (profile_screen.dart)

### ✅ 功能完整性
| 需求项 | 状态 | 说明 |
|--------|------|------|
| 用户头像区域 | ✅ 已实现 | 显示默认头像和昵称 |
| 统计数据展示 | ✅ 已实现 | 显示 "已走路线" 数量（硬编码为12） |
| 设置入口 | ✅ 已实现 | 设置、消息通知、帮助与反馈、关于我们 |

### 📊 数据流评估
- ⚠️ **问题**: 所有数据均为硬编码，未接入用户系统
- ⚠️ **问题**: 设置项点击无响应（`onTap: () {}`）

### 🎯 用户体验
- ✅ 界面简洁清晰
- ✅ 使用绿色主题色，与整体风格一致
- ⚠️ **问题**: 用户无法修改头像、昵称等个人信息
- ⚠️ **问题**: 点击设置项无反馈，用户会感到困惑

### ⚠️ 风险点
| 风险 | 等级 | 说明 |
|------|------|------|
| 静态页面 | 低 | 当前仅为展示，无实际功能 |
| 统计数据虚假 | 低 | "12条已走路线" 是硬编码 |

---

## 5. 页面间数据流评估

### 数据流图
```
DiscoveryScreen (发现页)
    ↓ (trailData)
TrailDetailScreen (路线详情页 - 发现页跳转)
    ↓ (无跳转，_startNavigation 为 TODO)

MapScreen (地图页)
    ↓ (routeName, distance, duration)
RouteDetailScreen (路线详情页 - 地图页跳转)
    ↓ (routeName)
NavigationScreen (导航页)
```

### ⚠️ 关键问题
1. **两个路线详情页**: 发现页和地图页分别跳转到不同的详情页（`TrailDetailScreen` vs `RouteDetailScreen`），数据结构和功能不一致
2. **发现页详情无法开始导航**: `TrailDetailScreen._startNavigation()` 仅显示 SnackBar，未实际跳转到导航页
3. **数据不互通**: 发现页使用 `trails-all.json`，地图页使用硬编码数据

---

## 6. 总体评估

### 功能完成度: 75%

| 页面 | 完成度 | 主要问题 |
|------|--------|----------|
| 发现页 | 90% | 图片为占位图，卡片缺少难度显示 |
| 地图页 | 70% | 搜索/筛选未实现，数据硬编码，API Key 安全 |
| 导航页 | 60% | 轨迹硬编码，缺少真实导航功能 |
| 我的页 | 50% | 纯静态页面，无实际功能 |

### 优先级建议

#### 🔴 P0 - 必须修复
1. **移除硬编码的 API Key**: 使用环境变量或配置文件管理
2. **统一路线详情页**: 合并 `TrailDetailScreen` 和 `RouteDetailScreen`
3. **修复发现页导航入口**: `TrailDetailScreen` 应能跳转到 `NavigationScreen`

#### 🟡 P1 - 高优先级
4. **地图页接入真实数据**: 使用 `trails-all.json` 动态生成标记点
5. **实现搜索和筛选功能**: 地图页的搜索栏和标签筛选需要实际功能
6. **导航页动态轨迹**: 根据传入的路线坐标绘制导航轨迹

#### 🟢 P2 - 优化建议
7. **路线卡片显示难度**: 在 `RouteCard` 中添加难度标签
8. **我的页接入用户数据**: 接入登录用户信息和真实统计数据
9. **图片资源替换**: 将 `picsum.photos` 替换为真实路线图片

---

## 7. 结论

本次开发完成了四个核心页面的基础框架，发现页的数据接入较为完善，但地图页和导航页仍存在较多硬编码内容。最大的风险是 **API Key 明文存储** 和 **页面间数据流不统一**。

建议在继续开发新功能前，优先修复 P0 级别的问题，确保代码安全性和页面间数据一致性。

---

*报告生成时间: 2026-02-28*  
*Review 版本: Week 5 Day 4*
