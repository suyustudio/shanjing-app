# 山径 APP 权限申请流程文档

> 版本: v1.0  
> 更新日期: 2026-02-27  
> 适用范围: 产品、设计、开发、测试团队

---

## 一、权限申请总览

### 1.1 权限清单

| 权限类型 | 权限名称 | 权限级别 | 必需/可选 | 适用平台 |
|---------|---------|---------|----------|---------|
| **定位权限** | 位置信息 | 危险权限 | 必需 | iOS/Android |
| **存储权限** | 文件存储 | 危险权限 | 必需 | Android |
| **相机权限** | 相机使用 | 危险权限 | 可选 | iOS/Android |
| **麦克风权限** | 录音 | 危险权限 | 可选 | iOS/Android |
| **通知权限** | 推送通知 | 普通权限 | 可选 | iOS/Android |

### 1.2 申请时机总览

```
用户旅程                权限申请时机
─────────────────────────────────────────────────
首次启动    ───────►   定位权限（使用前说明）
   │
   ▼
首页浏览    ───────►   （无权限申请）
   │
   ▼
开始记录路线 ───────►   定位权限（如未授权）
   │                    存储权限（Android，如未授权）
   ▼
记录中拍照  ───────►   相机权限（如未授权）
   │
   ▼
记录中语音标记 ─────►   麦克风权限（如未授权）
   │
   ▼
完成保存    ───────►   （无权限申请）
   │
   ▼
分享路线    ───────►   存储权限（Android，保存图片时）
```

---

## 二、定位权限申请

### 2.1 权限说明

| 属性 | 说明 |
|-----|------|
| **权限用途** | 获取用户实时位置，用于路线记录、地图展示、导航功能 |
| **权限级别** | 危险权限（需运行时申请） |
| **系统选项** | iOS：永不/使用期间/始终；Android：仅使用期间/始终/拒绝 |
| **必需性** | 核心功能必需，拒绝则无法使用路线记录功能 |

### 2.2 申请时机

#### 时机1：首次启动 - 使用前说明（推荐授权）

**触发条件：** 用户首次打开APP，进入首页前

**前置弹窗文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     📍 需要获取您的位置信息              │
│                                         │
│  山径需要获取您的位置信息，用于：        │
│                                         │
│  • 在地图上显示您的当前位置             │
│  • 记录您的户外路线轨迹                 │
│  • 提供语音导航和偏离提醒               │
│                                         │
│  您的位置数据仅用于本地记录，           │
│  未经您的同意不会上传到服务器。         │
│                                         │
│      [稍后再说]        [去开启]         │
│                                         │
└─────────────────────────────────────────┘
```

**用户选择处理：**
- 点击【去开启】→ 跳转系统设置页或弹出系统权限弹窗
- 点击【稍后再说】→ 进入首页，在地图页显示提示条

#### 时机2：开始记录路线 - 强制授权（必需授权）

**触发条件：** 用户点击"开始记录"按钮，但定位权限被拒绝

**拦截弹窗文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     ⚠️ 无法开始记录                     │
│                                         │
│  路线记录需要获取您的位置信息，          │
│  请在系统设置中开启定位权限。            │
│                                         │
│  开启路径：设置 → 应用 → 山径 → 位置    │
│                                         │
│      [取消]           [去设置]          │
│                                         │
└─────────────────────────────────────────┘
```

**用户选择处理：**
- 点击【去设置】→ 跳转系统设置页
- 点击【取消】→ 停留在当前页面，显示权限引导提示

### 2.3 权限状态处理

| 权限状态 | 页面表现 | 用户引导 |
|---------|---------|---------|
| **已授权（始终/使用期间）** | 正常显示地图和定位点 | 无 |
| **首次询问** | 显示使用前说明弹窗 | 解释权限用途，引导授权 |
| **拒绝（可再次询问）** | 地图显示默认位置，顶部提示条 | "开启定位以记录路线" |
| **永久拒绝** | 同上，点击提示条跳转设置 | "定位权限被禁用，点击开启" |

### 2.4 提示条文案

**首页/地图页提示条（权限被拒绝时）：**

```
┌─────────────────────────────────────────┐
│ ⚠️ 定位权限未开启，无法记录路线    [开启] │
└─────────────────────────────────────────┘
```

---

## 三、存储权限申请（Android）

### 3.1 权限说明

| 属性 | 说明 |
|-----|------|
| **权限用途** | 保存路线数据、离线地图包、照片到本地存储 |
| **权限级别** | 危险权限（Android 11及以下需运行时申请） |
| **系统选项** | 允许/拒绝 |
| **必需性** | 核心功能必需，拒绝则无法保存路线和下载离线包 |

### 3.2 申请时机

#### 时机1：首次开始记录路线

**触发条件：** 用户点击"开始记录"，需要创建本地路线文件时

**前置说明文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     💾 需要存储权限                      │
│                                         │
│  山径需要访问您的设备存储，用于：        │
│                                         │
│  • 保存您的路线记录数据                 │
│  • 下载离线地图包                       │
│  • 保存路线照片到相册                   │
│                                         │
│  我们不会访问您的个人文件，             │
│  仅用于APP相关数据的存储。              │
│                                         │
│      [取消]           [允许]            │
│                                         │
└─────────────────────────────────────────┘
```

#### 时机2：下载离线地图包

**触发条件：** 用户点击"下载离线地图包"按钮

**前置说明文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     🗺️ 下载离线地图包                   │
│                                         │
│  下载离线地图包需要存储权限，            │
│  用于将地图数据保存到您的设备。          │
│                                         │
│  预计占用存储空间：XXX MB               │
│                                         │
│      [取消]           [允许]            │
│                                         │
└─────────────────────────────────────────┘
```

### 3.3 iOS 存储说明

iOS 无需申请存储权限，但需要在 Info.plist 中声明：

```xml
<!-- 保存照片到相册 -->
<key>NSPhotoLibraryAddUsageDescription</key>
<string>山径需要访问相册，用于保存路线照片</string>

<!-- 读取相册（如需要） -->
<key>NSPhotoLibraryUsageDescription</key>
<string>山径需要访问相册，用于选择照片添加到路线</string>
```

---

## 四、相机权限申请

### 4.1 权限说明

| 属性 | 说明 |
|-----|------|
| **权限用途** | 拍摄照片添加到路线标记点 |
| **权限级别** | 危险权限（需运行时申请） |
| **系统选项** | 允许/拒绝 |
| **必需性** | 可选功能，拒绝后仍可使用其他功能 |

### 4.2 申请时机

#### 时机：记录中点击拍照按钮

**触发条件：** 用户在路线记录过程中，点击"添加照片标记"或拍照按钮

**前置说明文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     📷 需要相机权限                      │
│                                         │
│  开启相机权限后，您可以在记录路线时      │
│  拍摄照片，标记沿途风景和重要地点。      │
│                                         │
│  照片将保存到您的路线记录中，           │
│  可随时查看和分享。                     │
│                                         │
│      [暂不开启]        [去开启]         │
│                                         │
└─────────────────────────────────────────┘
```

### 4.3 权限拒绝处理

| 用户操作 | 系统响应 |
|---------|---------|
| 点击【暂不开启】 | 关闭弹窗，返回记录页面，可继续使用其他功能 |
| 点击【去开启】后拒绝 | 返回记录页面，显示提示"可在设置中随时开启相机权限" |
| 永久拒绝后再次点击拍照 | 弹窗提示"相机权限被禁用，请前往设置开启" |

---

## 五、麦克风权限申请

### 5.1 权限说明

| 属性 | 说明 |
|-----|------|
| **权限用途** | 录制语音标记、语音导航反馈 |
| **权限级别** | 危险权限（需运行时申请） |
| **系统选项** | 允许/拒绝 |
| **必需性** | 可选功能，拒绝后仍可使用文字标记 |

### 5.2 申请时机

#### 时机：记录中点击语音标记

**触发条件：** 用户在路线记录过程中，点击"添加语音标记"按钮

**前置说明文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     🎤 需要麦克风权限                    │
│                                         │
│  开启麦克风权限后，您可以在记录路线时    │
│  录制语音标记，快速记录沿途见闻。        │
│                                         │
│  语音标记将保存到您的路线中，           │
│  回放时可收听。                         │
│                                         │
│      [暂不开启]        [去开启]         │
│                                         │
└─────────────────────────────────────────┘
```

---

## 六、通知权限申请

### 6.1 权限说明

| 属性 | 说明 |
|-----|------|
| **权限用途** | 路线完成提醒、好友互动通知、活动推送 |
| **权限级别** | 普通权限（iOS需申请，Android默认允许） |
| **系统选项** | 允许/拒绝 |
| **必需性** | 可选功能，拒绝后不影响核心功能 |

### 6.2 申请时机

#### 时机：用户完成首次路线记录后

**触发条件：** 用户成功保存第一条路线

**前置说明文案：**

```
┌─────────────────────────────────────────┐
│                                         │
│     🎉 恭喜完成第一条路线！              │
│                                         │
│  开启通知后，我们将为您推送：            │
│                                         │
│  • 路线记录完成提醒                     │
│  • 好友对您路线的点赞和评论             │
│  • 精选路线推荐和活动通知               │
│                                         │
│      [暂不开启]        [开启通知]       │
│                                         │
└─────────────────────────────────────────┘
```

**策略说明：**
- 不在首次启动时申请，避免打扰
- 在用户完成核心价值行为（记录路线）后申请，提高接受度
- 提供明确的价值说明，让用户了解开启通知的好处

---

## 七、权限申请最佳实践

### 7.1 申请原则

| 原则 | 说明 | 示例 |
|-----|------|------|
| **按需申请** | 只在功能需要时申请权限 | 相机权限在点击拍照时才申请 |
| **前置说明** | 系统弹窗前先说明用途 | 使用自定义弹窗解释权限用途 |
| **价值导向** | 强调权限给用户带来的价值 | "记录您的精彩路线"而非"获取您的位置" |
| **优雅降级** | 权限被拒绝后提供替代方案 | 相机被拒后可选择相册照片 |
| **可重新申请** | 提供重新开启权限的入口 | 设置页、提示条都可跳转系统设置 |

### 7.2 文案规范

**DO（推荐）：**
- ✅ "记录您的户外路线轨迹"
- ✅ "保存您的路线照片"
- ✅ "拍摄照片标记沿途风景"
- ✅ "在地图上显示您的位置"

**DON'T（避免）：**
- ❌ "获取您的位置信息"
- ❌ "访问您的相册"
- ❌ "使用您的相机"
- ❌ "读取您的存储"

### 7.3 系统配置

#### iOS Info.plist 配置

```xml
<!-- 定位权限 -->
<key>NSLocationWhenInUseUsageDescription</key>
<string>山径需要获取您的位置，用于在地图上显示您的当前位置和记录路线轨迹</string>

<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>山径需要在后台获取位置，用于持续记录您的路线轨迹（仅在开始记录后）</string>

<!-- 相机权限 -->
<key>NSCameraUsageDescription</key>
<string>山径需要使用相机，用于拍摄照片添加到路线标记点</string>

<!-- 麦克风权限 -->
<key>NSMicrophoneUsageDescription</key>
<string>山径需要使用麦克风，用于录制语音标记</string>

<!-- 相册权限 -->
<key>NSPhotoLibraryAddUsageDescription</key>
<string>山径需要访问相册，用于保存路线照片</string>

<key>NSPhotoLibraryUsageDescription</key>
<string>山径需要访问相册，用于选择照片添加到路线</string>
```

#### Android AndroidManifest.xml 配置

```xml
<!-- 定位权限 -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />

<!-- 存储权限（Android 10及以下） -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />

<!-- 相机权限 -->
<uses-permission android:name="android.permission.CAMERA" />

<!-- 麦克风权限 -->
<uses-permission android:name="android.permission.RECORD_AUDIO" />

<!-- 通知权限（Android 13+） -->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
```

---

## 八、权限状态管理

### 8.1 权限状态流转图

```
                    ┌─────────────┐
                    │   未申请    │
                    └──────┬──────┘
                           │ 申请权限
                           ▼
              ┌────────────────────────┐
              │                        │
              ▼                        ▼
       ┌─────────────┐          ┌─────────────┐
       │   已授权    │          │   被拒绝    │
       └──────┬──────┘          └──────┬──────┘
              │                        │
              │ 用户关闭权限           │ 再次申请
              ▼                        ▼
       ┌─────────────┐          ┌─────────────┐
       │  授权被撤销 │          │ 永久拒绝    │
       │ （iOS设置中）│          │（勾选不再询问）│
       └─────────────┘          └──────┬──────┘
                                       │
                                       ▼
                                ┌─────────────┐
                                │  引导至设置  │
                                └─────────────┘
```

### 8.2 权限检查逻辑

```
开始功能流程
    │
    ▼
检查权限状态 ──► 已授权 ──► 继续功能流程
    │
    ▼ 未授权/被拒绝
显示前置说明弹窗
    │
    ▼
用户选择 ──► 同意 ──► 调起系统权限申请
    │
    ▼ 拒绝
判断是否必需权限
    │
    ├──► 必需 ──► 显示引导设置弹窗，阻止功能使用
    │
    └──► 可选 ──► 允许功能降级使用，提供替代方案
```

---

## 九、版本历史

| 版本 | 日期 | 更新内容 | 更新人 |
|-----|------|---------|-------|
| v1.0 | 2026-02-27 | 初始版本，定义定位、存储、相机、麦克风、通知权限申请流程和文案 | 产品团队 |
